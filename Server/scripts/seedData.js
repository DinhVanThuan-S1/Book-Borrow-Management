const mongoose = require("mongoose");
require("dotenv").config();

// Import models
const NhanVien = require("../models/NhanVien.model");
const DocGia = require("../models/DocGia.model");
const NhaXuatBan = require("../models/NhaXuatBan.model");
const DanhMuc = require("../models/DanhMuc.model");
const Sach = require("../models/Sach.model");

// K·∫øt n·ªëi database
mongoose.connect(process.env.MONGODB_URI);

const seedData = async () => {
  try {
    console.log("üå± B·∫Øt ƒë·∫ßu kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u...");

    // X√≥a d·ªØ li·ªáu c≈© n·∫øu c√≥
    console.log("üóëÔ∏è  ƒêang x√≥a d·ªØ li·ªáu c≈©...");
    await Promise.all([
      NhanVien.deleteMany({}),
      DocGia.deleteMany({}),
      NhaXuatBan.deleteMany({}),
      DanhMuc.deleteMany({}),
      Sach.deleteMany({}),
    ]);

    // T·∫°o admin m·∫∑c ƒë·ªãnh
    console.log("üëë T·∫°o admin...");
    const admin = new NhanVien({
      HoTenNV: "Admin H·ªá Th·ªëng",
      Email: "admin@library.com",
      Password: "admin123",
      ChucVu: "Admin",
      DiaChi: "S·ªë 1 ƒê·∫°i C·ªì Vi·ªát, Hai B√† Tr∆∞ng, H√† N·ªôi",
      SoDienThoai: "0123456789",
    });
    await admin.save();
    console.log(`   ‚úÖ Admin: ${admin.MSNV} - ${admin.Email}`);

    // T·∫°o nh√¢n vi√™n m·∫´u
    console.log("üë®‚Äçüíº T·∫°o nh√¢n vi√™n...");
    const nhanVien = new NhanVien({
      HoTenNV: "Nguy·ªÖn VƒÉn Nh√¢n Vi√™n",
      Email: "nhanvien@library.com",
      Password: "nhanvien123",
      ChucVu: "NhanVien",
      DiaChi: "123 Nguy·ªÖn Hu·ªá, Qu·∫≠n 1, TP.HCM",
      SoDienThoai: "0987654321",
    });
    await nhanVien.save();
    console.log(`   ‚úÖ Nh√¢n vi√™n: ${nhanVien.MSNV} - ${nhanVien.Email}`);

    // T·∫°o nh√† xu·∫•t b·∫£n m·∫´u
    console.log("üè¢ T·∫°o nh√† xu·∫•t b·∫£n...");
    const nxbList = [];
    const nxbData = [
      { TenNXB: "NXB Tr·∫ª", DiaChi: "161B L√Ω Ch√≠nh Th·∫Øng, Qu·∫≠n 3, TP.HCM" },
      {
        TenNXB: "NXB Kim ƒê·ªìng",
        DiaChi: "55 Quang Trung, Hai B√† Tr∆∞ng, H√† N·ªôi",
      },
      {
        TenNXB: "NXB Gi√°o d·ª•c Vi·ªát Nam",
        DiaChi: "81 Tr·∫ßn H∆∞ng ƒê·∫°o, Ho√†n Ki·∫øm, H√† N·ªôi",
      },
      {
        TenNXB: "NXB Th·∫ø Gi·ªõi",
        DiaChi: "7 Nguy·ªÖn Th·ªã Minh Khai, Qu·∫≠n 1, TP.HCM",
      },
      { TenNXB: "NXB VƒÉn h·ªçc", DiaChi: "18 Nguy·ªÖn Tr∆∞·ªùng T·ªô, Ba ƒê√¨nh, H√† N·ªôi" },
    ];

    for (const data of nxbData) {
      const nxb = new NhaXuatBan(data);
      await nxb.save();
      nxbList.push(nxb);
      console.log(`   ‚úÖ NXB: ${nxb.MaNXB} - ${nxb.TenNXB}`);
    }

    // T·∫°o danh m·ª•c m·∫´u
    console.log("üìö T·∫°o danh m·ª•c s√°ch...");
    const danhMucList = [];
    const dmData = [
      {
        TenDM: "VƒÉn h·ªçc",
        MoTa: "S√°ch vƒÉn h·ªçc trong n∆∞·ªõc v√† n∆∞·ªõc ngo√†i",
        NguoiTao: admin._id,
      },
      {
        TenDM: "Khoa h·ªçc c√¥ng ngh·ªá",
        MoTa: "S√°ch khoa h·ªçc k·ªπ thu·∫≠t v√† c√¥ng ngh·ªá th√¥ng tin",
        NguoiTao: admin._id,
      },
      {
        TenDM: "L·ªãch s·ª≠",
        MoTa: "S√°ch l·ªãch s·ª≠ Vi·ªát Nam v√† th·∫ø gi·ªõi",
        NguoiTao: admin._id,
      },
      {
        TenDM: "Kinh t·∫ø",
        MoTa: "S√°ch v·ªÅ kinh t·∫ø, qu·∫£n l√Ω v√† kinh doanh",
        NguoiTao: admin._id,
      },
      {
        TenDM: "Thi·∫øu nhi",
        MoTa: "S√°ch d√†nh cho tr·∫ª em v√† thi·∫øu ni√™n",
        NguoiTao: nhanVien._id,
      },
      {
        TenDM: "Y h·ªçc",
        MoTa: "S√°ch v·ªÅ y h·ªçc v√† s·ª©c kh·ªèe",
        NguoiTao: admin._id,
      },
      {
        TenDM: "T√¢m l√Ω h·ªçc",
        MoTa: "S√°ch v·ªÅ t√¢m l√Ω h·ªçc v√† ph√°t tri·ªÉn b·∫£n th√¢n",
        NguoiTao: nhanVien._id,
      },
    ];

    for (const data of dmData) {
      const dm = new DanhMuc(data);
      await dm.save();
      danhMucList.push(dm);
      console.log(`   ‚úÖ Danh m·ª•c: ${dm.MaDM} - ${dm.TenDM}`);
    }

    // T·∫°o s√°ch m·∫´u
    console.log("üìñ T·∫°o s√°ch...");
    const sachList = [];
    const sachData = [
      {
        TenSach: "T√¥i th·∫•y hoa v√†ng tr√™n c·ªè xanh",
        MoTa: "Ti·ªÉu thuy·∫øt n·ªïi ti·∫øng c·ªßa Nguy·ªÖn Nh·∫≠t √Ånh v·ªÅ tu·ªïi th∆° ƒë·∫ßy c·∫£m x√∫c",
        DonGia: 85000,
        SoQuyen: 15,
        NamXuatBan: 2010,
        TacGia: "Nguy·ªÖn Nh·∫≠t √Ånh",
        MaNXB: nxbList[0]._id,
        MaDM: danhMucList[0]._id,
        NguoiTao: admin._id,
      },
      {
        TenSach: "L·∫≠p tr√¨nh JavaScript t·ª´ A ƒë·∫øn Z",
        MoTa: "H∆∞·ªõng d·∫´n l·∫≠p tr√¨nh JavaScript t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao v·ªõi c√°c v√≠ d·ª• th·ª±c t·∫ø",
        DonGia: 120000,
        SoQuyen: 8,
        NamXuatBan: 2023,
        TacGia: "Nguy·ªÖn VƒÉn Dev",
        MaNXB: nxbList[1]._id,
        MaDM: danhMucList[1]._id,
        NguoiTao: admin._id,
      },
      {
        TenSach: "L·ªãch s·ª≠ Vi·ªát Nam",
        MoTa: "T√¨m hi·ªÉu v·ªÅ l·ªãch s·ª≠ d√¢n t·ªôc Vi·ªát Nam qua c√°c th·ªùi k·ª≥ ph√°t tri·ªÉn",
        DonGia: 95000,
        SoQuyen: 12,
        NamXuatBan: 2022,
        TacGia: "GS. Phan Huy L√™",
        MaNXB: nxbList[2]._id,
        MaDM: danhMucList[2]._id,
        NguoiTao: nhanVien._id,
      },
      {
        TenSach: "Kinh t·∫ø h·ªçc vi m√¥",
        MoTa: "Gi√°o tr√¨nh kinh t·∫ø h·ªçc vi m√¥ d√†nh cho sinh vi√™n v√† ng∆∞·ªùi quan t√¢m",
        DonGia: 150000,
        SoQuyen: 6,
        NamXuatBan: 2023,
        TacGia: "TS. Nguy·ªÖn VƒÉn Kinh",
        MaNXB: nxbList[3]._id,
        MaDM: danhMucList[3]._id,
        NguoiTao: admin._id,
      },
      {
        TenSach: "Doraemon - Nobita v√† v∆∞∆°ng qu·ªëc robot",
        MoTa: "Truy·ªán tranh Doraemon d√†nh cho thi·∫øu nhi v·ªõi nh·ªØng cu·ªôc phi√™u l∆∞u th√∫ v·ªã",
        DonGia: 25000,
        SoQuyen: 20,
        NamXuatBan: 2023,
        TacGia: "Fujiko F. Fujio",
        MaNXB: nxbList[1]._id,
        MaDM: danhMucList[4]._id,
        NguoiTao: nhanVien._id,
      },
      {
        TenSach: "Node.js v√† MongoDB - X√¢y d·ª±ng ·ª©ng d·ª•ng Web",
        MoTa: "H∆∞·ªõng d·∫´n chi ti·∫øt x√¢y d·ª±ng ·ª©ng d·ª•ng web v·ªõi Node.js v√† MongoDB",
        DonGia: 135000,
        SoQuyen: 10,
        NamXuatBan: 2024,
        TacGia: "ƒêinh VƒÉn Thu·∫≠n",
        MaNXB: nxbList[1]._id,
        MaDM: danhMucList[1]._id,
        NguoiTao: admin._id,
      },
      {
        TenSach: "Gi·∫£i ph·∫´u sinh l√Ω h·ªçc ng∆∞·ªùi",
        MoTa: "S√°ch gi√°o khoa v·ªÅ gi·∫£i ph·∫´u v√† sinh l√Ω h·ªçc c∆° th·ªÉ ng∆∞·ªùi",
        DonGia: 180000,
        SoQuyen: 5,
        NamXuatBan: 2023,
        TacGia: "BS. Tr·∫ßn VƒÉn Y",
        MaNXB: nxbList[2]._id,
        MaDM: danhMucList[5]._id,
        NguoiTao: admin._id,
      },
      {
        TenSach: "ƒê·∫Øc Nh√¢n T√¢m",
        MoTa: "Cu·ªën s√°ch kinh ƒëi·ªÉn v·ªÅ ngh·ªá thu·∫≠t giao ti·∫øp v√† ·ª©ng x·ª≠",
        DonGia: 90000,
        SoQuyen: 25,
        NamXuatBan: 2020,
        TacGia: "Dale Carnegie",
        MaNXB: nxbList[4]._id,
        MaDM: danhMucList[6]._id,
        NguoiTao: nhanVien._id,
      },
      {
        TenSach: "Nh√† gi·∫£ kim",
        MoTa: "Ti·ªÉu thuy·∫øt n·ªïi ti·∫øng v·ªÅ h√†nh tr√¨nh t√¨m ki·∫øm ∆∞·ªõc m∆°",
        DonGia: 75000,
        SoQuyen: 18,
        NamXuatBan: 2019,
        TacGia: "Paulo Coelho",
        MaNXB: nxbList[4]._id,
        MaDM: danhMucList[0]._id,
        NguoiTao: admin._id,
      },
      {
        TenSach: "React.js - X√¢y d·ª±ng giao di·ªán ng∆∞·ªùi d√πng",
        MoTa: "H∆∞·ªõng d·∫´n to√†n di·ªán v·ªÅ React.js cho frontend developers",
        DonGia: 140000,
        SoQuyen: 7,
        NamXuatBan: 2024,
        TacGia: "L√™ VƒÉn Frontend",
        MaNXB: nxbList[1]._id,
        MaDM: danhMucList[1]._id,
        NguoiTao: admin._id,
      },
    ];

    for (const data of sachData) {
      const sach = new Sach(data);
      await sach.save();
      sachList.push(sach);
      console.log(`   ‚úÖ S√°ch: ${sach.MaSach} - ${sach.TenSach}`);
    }

    // T·∫°o ƒë·ªôc gi·∫£ m·∫´u
    console.log("üë§ T·∫°o ƒë·ªôc gi·∫£...");
    const docgiaList = [];
    const docgiaData = [
      {
        HoLot: "Nguy·ªÖn VƒÉn",
        Ten: "An",
        Email: "docgia1@test.com",
        Password: "123456",
        NgaySinh: new Date("1995-01-01"),
        Phai: "Nam",
        DiaChi: "S·ªë 15 L√™ L·ª£i, Qu·∫≠n 1, TP.HCM",
        DienThoai: "0987654321",
      },
      {
        HoLot: "Tr·∫ßn Th·ªã",
        Ten: "B√¨nh",
        Email: "docgia2@test.com",
        Password: "123456",
        NgaySinh: new Date("1998-05-15"),
        Phai: "N·ªØ",
        DiaChi: "S·ªë 25 Tr·∫ßn Duy H∆∞ng, C·∫ßu Gi·∫•y, H√† N·ªôi",
        DienThoai: "0976543210",
      },
      {
        HoLot: "L√™ Minh",
        Ten: "C∆∞·ªùng",
        Email: "docgia3@test.com",
        Password: "123456",
        NgaySinh: new Date("1992-12-20"),
        Phai: "Nam",
        DiaChi: "S·ªë 78 Nguy·ªÖn Th√°i H·ªçc, Qu·∫≠n 1, TP.HCM",
        DienThoai: "0965432109",
      },
      {
        HoLot: "Ph·∫°m Th·ªã",
        Ten: "Dung",
        Email: "docgia4@test.com",
        Password: "123456",
        NgaySinh: new Date("1996-08-10"),
        Phai: "N·ªØ",
        DiaChi: "S·ªë 45 Ho√†ng Qu·ªëc Vi·ªát, C·∫ßu Gi·∫•y, H√† N·ªôi",
        DienThoai: "0954321098",
      },
      {
        HoLot: "Ho√†ng VƒÉn",
        Ten: "ƒê·ª©c",
        Email: "docgia5@test.com",
        Password: "123456",
        NgaySinh: new Date("1994-03-25"),
        Phai: "Nam",
        DiaChi: "S·ªë 89 Pasteur, Qu·∫≠n 3, TP.HCM",
        DienThoai: "0943210987",
      },
    ];

    for (const data of docgiaData) {
      const docgia = new DocGia(data);
      await docgia.save();
      docgiaList.push(docgia);
      console.log(`   ‚úÖ ƒê·ªôc gi·∫£: ${docgia.MaDocGia} - ${docgia.Email}`);
    }

    console.log("üéâ Kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u ho√†n th√†nh!");
    console.log("");
    console.log("üìù TH√îNG TIN ƒêƒÇNG NH·∫¨P:");
    console.log("‚îÄ".repeat(60));
    console.log("üëë ADMIN:");
    console.log(`   üìß Email: admin@library.com`);
    console.log(`   üîë Password: admin123`);
    console.log(`   üÜî MSNV: ${admin.MSNV}`);
    console.log("");
    console.log("üë®‚Äçüíº NH√ÇN VI√äN:");
    console.log(`   üìß Email: nhanvien@library.com`);
    console.log(`   üîë Password: nhanvien123`);
    console.log(`   üÜî MSNV: ${nhanVien.MSNV}`);
    console.log("");
    console.log("üë§ ƒê·ªòC GI·∫¢:");
    docgiaList.forEach((dg, index) => {
      console.log(
        `   ${index + 1}. üìß ${dg.Email} | üîë 123456 | üÜî ${dg.MaDocGia}`
      );
    });
    console.log("");
    console.log("üìä TH·ªêNG K√ä D·ªÆ LI·ªÜU:");
    console.log("‚îÄ".repeat(60));
    console.log(`üìö ${danhMucList.length} danh m·ª•c s√°ch`);
    console.log(`üè¢ ${nxbList.length} nh√† xu·∫•t b·∫£n`);
    console.log(`üìñ ${sachList.length} ƒë·∫ßu s√°ch`);
    console.log(`üë§ ${docgiaList.length} ƒë·ªôc gi·∫£`);
    console.log(`üë®‚Äçüíº 2 nh√¢n vi√™n (1 admin + 1 nh√¢n vi√™n)`);
    console.log("");
    console.log("üÜî M√É S·ªê ƒê∆Ø·ª¢C T·∫†O:");
    console.log("‚îÄ".repeat(60));
    console.log("üìö Danh m·ª•c:");
    danhMucList.forEach((dm) => console.log(`   ${dm.MaDM} - ${dm.TenDM}`));
    console.log("üè¢ Nh√† xu·∫•t b·∫£n:");
    nxbList.forEach((nxb) => console.log(`   ${nxb.MaNXB} - ${nxb.TenNXB}`));
    console.log("üìñ S√°ch:");
    sachList.forEach((sach) =>
      console.log(`   ${sach.MaSach} - ${sach.TenSach}`)
    );
    console.log("");
    console.log("üöÄ H·ªá th·ªëng s·∫µn s√†ng s·ª≠ d·ª•ng!");
    console.log("üåê API Base URL: http://localhost:5000/api");
    console.log("üìö Database: QuanLyMuonSach");
    console.log(`‚è∞ Kh·ªüi t·∫°o l√∫c: ${new Date().toLocaleString("vi-VN")}`);

    process.exit(0);
  } catch (error) {
    console.error("‚ùå L·ªói kh·ªüi t·∫°o d·ªØ li·ªáu:", error);
    console.error("Stack trace:", error.stack);
    process.exit(1);
  }
};

seedData();
